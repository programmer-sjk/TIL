# Redis Red Lock

- 여러 프로세스가 공유된 자원에 접근하면 동시성 문제가 발생하기 마련이다.
- 동시성 이슈를 해결하기 위한 몇 가지 방안들이 있지만 이 문서에는 Redis가 제공하는 RedLock에 대해 정리한다.
- RedLock은 Redis가 제공하는 분산 락(Distributed Lock)이다.

## 왜 하필 RedLock 인가?

- Redis는 싱글 스레드로 동작하기 떄문에 아래의 명령어로도 잠금을 획득할 수 있다.
  - 아래 명렁어는 `key`가 없을 경우 value를 저장하고 30초 동안 유지한다.
  - `SET key value NX PX 30000`
- 따라서 동시성 문제가 발생하지 않는데 왜 분산락이 필요할까?
  - 만약 Redis가 하나의 서버로 동작할 경우 단일 장애 지점(SPOF)이 될 수 있다.
- 이를 위해 복제 모드(Master - Slave)로 구성할 수 있다. 하지만 Redis의 복제는 비동기라 문제가 발생할 수 있다.
  - 클라이언트 A가 마스터에서 잠금을 획득한다.
  - 키에 대한 쓰기가 복제본으로 전송되기 전 Master가 다운된다.
  - 키가 쓰여지지 않은 Slave가 Master로 승격한다.
  - 클라이언트 B가 새로운 마스터에서 동일한 키로 잠금을 획득한다.
- 이런 문제를 보완하기 위해 RedLock 알고리즘이 제안되었다.
