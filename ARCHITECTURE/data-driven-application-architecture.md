# 데이터 중심 어플리케이션 설계

## 1. 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 어플리케이션

- 이번 장에서는 엔지니어링 관점에서 **신뢰성, 확장성, 유지보수성**을 생각하는 방법을 살펴본다.

### 신뢰성

- **결함이 발생해도 시스템이 올바르게 동작**하게 만든다는 의미다.
- 결함은 HW, SW 버그, 사람에게 있을 수 있다.
- 대략 무언가 잘못되더라도 지속적으로 올바르게 동작함을 신뢰성의 의미로 이해할 수 있다.

### 확장성

- 시스템이 현재 안정적으로 동작한다고 미래에도 안정적으로 동작한다는 보장은 없다. 성능 저하를 유발하는
흔한 이유 중 하나는 부하 증가다. 확**장성은 부하가 증가해도 좋은 성능을 유지하기 위한 전략**을 의미한다.
- **응답시간은** 클라이언트 관점에서 요청을 처리하는 실제시간(네트워크 지연, 큐 지연 포함)이고 **지연시간은** 요청을 기다리며 휴지상태(latent)인 시간을 말한다.
- 아키텍처를 결정하는 요소는 읽기양, 쓰기양, 저장할 데이터 양, 데이터의 복잡도, 응답시간 요구사항 등이 있다.

### 유지보수성

- SW 비용의 대부분은 초기 개발이 아니라 지속해서 이어지는 유지보수에 들어간다는 사실이 잘 알려져있다.
- 유지보수의 본질은 시스템에서 작업하는 엔지니어와 운영 팀의 삶을 개선하는데 있다.
- 유지보수를 위해 관심가져야 할 시스템 설계 원칙은 다음과 같다.
  - **운용성**: 운영팀이 시스템을 원활하게 운영할 수 있도록 만들어라
  - **단순성**: 복잡도는 최대한 제거해 새로운 엔지니어가 시스템을 이해하기 쉽게 만들어라.
  - **발전성**: 요구사항 변경에 유연하게 대응하기 위해 시스템을 쉽게 변경할 수 있도록 만들어라.

### 1장 정리

- 안타깝게도 애플리케이션을 신뢰할 수 있고 확장 가능하며 유지보수하기 쉽게 만들어주는 간단한 해결책은 없다.
- 하지만 이런 애플리케이션에서 재현되는 **특정 패턴과 기술**이 있는데 이 후 몇개의 장에서 이를 살펴보자.

## 2. 데이터 모델과 질의 언어

- 데이터 모델은 SW 개발에서 중요한 부분을 차지하는데 왜냐면 데이터 모델은 SW가 해결하려는 **문제를 어떻게 생각해야 하는지도 큰 영향**을 미치기 때문이다.
- 하나의 데이터 모델을 완전히 익히는 데도 많은 노력이 필요하지만, 데이터 모델은 SW가 할 수 있는 일과 할 수 없는 일에 지대한 영향을 주므로 어플리케이션에 적합한 데이터 모델을 선택하는게 중요하다.

### 관계형 모델과 문서 모델

- 오늘날 가장 잘 알려진 데이터 모델은 관계형 모델을 기반으로 한 SQL로, RDB의 근원은 트랜잭션 처리나 일괄 처리로 오늘날 관점에서는 일상적으로 수행된다.
- `NoSQL`의 탄생
  - Not Only SQL로 이를 채택하는데는 **다양한 이유**가 있다.
    - 대규모의 쓰기 처리량을 쉽게 할 수 있는 뛰어난 확장성이 필요
    - 관계형 모델에서 지원하지 않는 특수 질의 동작
    - 동적이고 표현력이 풍부한 데이터 모델에 대한 바람
  - 이력서 같은 데이터 구조는 모든 내용을 갖추고 있는 문서라서 JSON 표현에 매우 적합하다.
  - JSON 표현은 다중 테이블 스키마보다 더 나은 지역성을 갖는다. 프로필 정보를 RDB에서 가져오려면 쿼리를 여러 번 날리거나 테이블 간에 다중 조인을 해야 한다. JSON 표현에서는 모든 관련 정보가 한 곳에 있어 질의 하나로 충분하다.
- 다대일과 다대다 관계를 표현할 때 **RDB와 문서 DB는 근본적으로 고유한 식별자**로 참조한다. RDB에서는 **외래키**라 부르고 문서 모델에서는 **문서 참조(document reference)**라 부른다.
- 관계형 데이터베이스와 오늘날의 문서 데이터 베이스
  - 문서 데이터 모델을 선호하는 이유는 스키마 유연성, 지역성에 기인한 더 나은 성능 때문이고 관계형 모델은 조인, 다대일, 다대다 관계를 더 잘 지원한다.
  - 데이터가 문서와 비슷한 구조(일대다 관계 트리로 보통 한번에 전체 트리를 적재)라면 문서 모델을 쓰는게 좋지만 어플리케이션이 다대다 관계를 사용하면 문서 모델의 매력이 떨어진다.
  - 대부분의 **문서 DB는 스키마를 강요하지 않기 때문에 컬렉션 안의 항목이 모두 동일한 구조가 아닐때** 유리하다.
    - 예를 들어 사용자가 제어할 수 없고 외부 시스템에 의해 데이터 구조가 결정되면 스키마는 득보다 실이 많다.
  - RDB도 JSON 지원 기능이 추가되고 있고, 문서 DB도 조인을 지원하는 경우가 있다. 각 데이터 모델이 서로 부족한 부분을 잘 보완해 나가고 있고 미래 DB들이 가야 할 올바른 길이다.

### 데이터를 위한 질의 언어

- 관계형 모델이 등장했을 떄 데이터를 질의하는 새로운 방법도 함께 나타났다. **SQL은 선언형 질의** 언어인 반면 IMS나 코다실은 **명령형 코드**를 사용해 DB에 질의한다.
- 명령형 언어는 특정 순서로 특정 연산을 수행하게끔 컴퓨터에게 지시하는 반면 선언형 질의 언어는 목표를 달성하기 위한 방법이 아니라 알고자 하는 데이터의 패턴이나 어떻게 변환할지를 지정한다.
- 선언형 질의 언어는 일반적으로 명령형 API보다 더 간결하며 DB 엔진의 상세 구현이 숨겨져 있어 질의를 변경하지 않고도 DB 성능을 향상시킬 수 있는 장점이 있다.


### 그래프형 데이터 모델

- 애플리케이션이 주로 일대다 관계이거나 레코드 간 관계가 없다면 문서 모델이 적합하다. 단순한 다대다 관계는 RDB로 충분히 다룰 수 있지만 데이터 간 연결이 복잡해지면 그래프로 데이터를 모델링하는게 좋을 수 있다.
- 속성 그래프와 트리플 저장소, 사이퍼, 스파클 등이 나오는데 솔직히 이런게 있다만 알고 넘어가자.

### 2장 정리

- 역사적으로 데이터를 하나의 큰 트리로 표현하려고 노력했지만 다대다 관계를 표현하기에는 트리구조가 적절하지 않았다.
- 이 문제를 해결하기 위해 관계형 모델이 고안됐고 최근 개발자들은 관계형 모델에도 적합하지 않은 애플리케이션이 있다는 사실을 발견했다.
- 새로 등장한 비관계형 NoSQL은 두 가지 주요 갈래가 있다.
  - **문서 데이터베이스는** 데이터가 문서 자체에 포함되어 있으면서 문서간 관계가 거의 없는 사용사례를 대상으로 한다.
  - **그래프 데이터베이스는** 정반대로 모든것이 관련있다는 사용사례를 대상으로 한다.
  - **문서 & 그래프 DB의 공통점**은 스키마를 강제하지 않아 요구사항에 맞춰 어플리케이션을 쉽게 할 수 있다는 점이다.
    - 하지만 보통 애플리케이션은 데이터가 특정 구조를 갖는다고 가정할 가능성이 높다.
