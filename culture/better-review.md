# 더 나은 코드리뷰를 향하여

- 근래 코드 리뷰를 조금 더 잘하고 싶다는 생각이 들었다.
- 내가 생각하는 좋은 코드 리뷰, 다른 개발자 분들의 의견 중 동의되는 것들을 이번 기회에 정리하려 한다.

## 내가 생각하는 코드 리뷰. 더 나은 코드 리뷰

- 코드 리뷰를 통해 무엇을 얻을 수 있을까? 개인적으로 생각하는 코드 리뷰의 순 기능은 아래와 같다.
  - 장애나 버그를 만드는 코드를 사전에 발견 및 수정
  - 컨벤션을 벗어난 코드들을 일관되게 유지
  - 코드 리뷰에 참여한 사람들이 합의하는 가독성이 더 나은 코드를 배포
- 리뷰를 통해 위와 같은 장점들을 얻을 수 있다고 하면 더 나은 코드리뷰는 어때야 할까?
  - 리뷰를 통해 서로의 성장을 돕는다.
  - 서로를 배려해야 한다.
  - 개선이나 변경을 요청한 코드에 대해 이유를 충분히 설명해야 한다.

## 공감되는 좋은 코드 리뷰에 대한 문화와 방법들

- 여러 블로그들을 보면서 공감이 된 방법들과 문화들을 정리한다.

### PR 잘 요청하기

- 코드 리뷰에서 LoC의 변경은 300 Line을 넘지 않도록 한다.

  - Cisco 시스템 프로그래밍 팀의 연구에 따르면 300줄에서 400줄 정도의 코드를 60분에서 90분 동안 리뷰하면 70~90%의 결함을 발견할 수 있다고 한다. 코드 리뷰와 관련된 여러 블로그를 읽으면서도 평균적으로 250~300 Line 이하를 권하는 추세.

  <img src="https://github.com/programmer-sjk/TIL/blob/main/images/culture/review-loc.png" width="500">

- 라인 수에 따른 결함 발견 밀집도

<img src="https://github.com/programmer-sjk/TIL/blob/main/images/culture/defect-loc.png" width="500">

- 리뷰어에게 PR을 통해 충분한 정보를 제공하자

```
Reviewer resource is very limited, treat it wisely!
(리뷰어는 매우 제한되어 있으니 그들을 현명하게 다룹시다!)
```

- 리뷰어 N명의 시간을 절약하기 위해 충분한 정보를 제공하는 것이 중요하다. **`저자가 고생해서`** 리뷰어의 시간을 아껴줘야 한다.
- 무슨 이유로 어떻게 코드를 변경했는지, 어떤 위험이나 우려가 발견되었는지에 대한 충분한 정보를 리뷰어에게 제공해야 한다.
- PR 템플릿을 잘 활용하자

### 개선이 필요한 이유에 대해 충분한 설명을 한다

- 저자에게 의견을 줄 때는 "제안하는 변경"과 "변경의 이유"를 모두 설명할 것

### 저 문맥(Low Context) 커뮤니케이션을 지향

- 질문을 하거나 대답을 할 때, 내가 알고 있는 것을 상대방도 알고 있을 것이라는 가정을 하지 않고 충분한 문맥을 전달해야 한다. 상대방의 의도를 파악하기 위한 추가적인 커뮤니케이션 또는 미스 커뮤니케이션으로 발생하는 비용이 매우 비싼 비용이라는 문제의식을 공유한다.

### 해결사가 아니라 조언자가 되도록 합시다

- 코드 리뷰에서 너무 공격적인 어투나 본인의 지식을 자랑하지 말자.
- 예를 들어 "이 코드는 이 부분이 잘못되었어요."라는 리뷰 보다는 "이 부분은 이런 문제가 있을 가능성이 있네요. 이런 방법으로 한번 체크해 보는 건 어떨까요?"라는 식의 조언을 통한 부드러운 코드 리뷰를 이끌어 보자.
- 팀 정신을 위해 불완전한 해결책을 받아들여라. 코드 리뷰의 목적은 비난이 아니라 배움이다.

### Request Change는 치명적인 오류를 가지고 있거나 누가 봐도 나쁜 디자인인 경우에 사용하자

- 선택적 제안과 치명적인 오류 또는 객관적으로 좋지 않은 디자인인 경우는 다르다. 자신이 좋다고 생각하는 구현방향으로 인해 리뷰이의 구현을 강제하지 말자. 만약 객관적으로 좋지 않은 설계인 경우에는 그 이유를 친절히 설명함으로써 리뷰이와의 커뮤니케이션 비용을 줄이는 것이 좋겠다.

## 코드 리뷰의 부작용

- 코드 리뷰가 좋은 개발 문화라고 해서 무작정 시작하다가 부작용이 발생하는 경우도 있다.

### 병목이 되는 코드 리뷰

- 가장 흔히 볼 수 있는 부작용은 바로 코드 리뷰라는 단계가 제품이 만들어지는 프로세스를 Blocking 하는 것이다
  - PR이 어떠한 요구사항을 해결하기 위해 어떠한 변경사항을 담고 있는 것인지 Reviewer가 이해하고 리뷰하는 과정에 시간과 에너지가 많이 소모된다. 일부 PR의 경우, 변경 사항의 사이즈가 커서 리뷰하는 데 있어 확인해야 하는 범위가 크고 부담으로 다가온다.
  - 리뷰어들의 일정이나 기능 개발이 바쁠 경우 자연스럽게 후순위로 밀리게 된다.
- Reviewer가 적은 노력으로도 PR 내용을 파악할 수 있도록 자세하게 설명해 주어야 한다.

### 의미없는 코드 리뷰

- 무지성 Approve 단계를 말한다.
- 각자의 개발을 진행하느라 바쁘다 보니 서로의 코드를 잘 안 보게 되고, 보더라도 깊이 있게 못 보니 유의미한 리뷰가 없는 것이다. 그 와중에 내 코드는 빨리 리뷰돼서 main branch에 들어가길 바라는 동상이몽이 펼쳐진다.

### 싸움이 되는 코드 리뷰

- 코드를 가지고 싸우기도 한다. 리뷰를 남기는 사람의 공격적인 말투도 있겠지만, 말투를 바꾸더라도 상처가 될 수 있다.
- 더 근원적인 문제가 있기 때문인데, 리뷰를 받는 사람이 리뷰를 자신에 대한 비난이라고 받아들이게 되면 비극이 시작된다.

### 책임 소재를 묻는 코드 리뷰

- 리뷰에 ‘승인’을 하는 것은 이 코드에 대한 ‘책임’을 함께 갖는 것이다. 라는 이야기도 있다.
- 이런 의미를 코드 리뷰 승인에 부여해서 얻는 실익이 없다. 문제가 된 코드의 작성자는 ‘리뷰를 받았으니 이 문제는 공동 책임이야!’ 라고 외쳐서 달라질 것도 없다. 문제의 책임은 그저 시스템에 있다. 문제가 발생했다면 시스템을 회고하고 문제가 됐던 부분을 함께 개선하면 된다.
