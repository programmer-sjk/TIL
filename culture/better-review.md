# 더 나은 코드리뷰를 향하여

- 근래 **코드 리뷰를 조금 더 잘하고 싶다는 생각**이 들었다.
- 내가 생각하는 좋은 코드 리뷰, 다른 개발자 분들의 의견 중 동의되는 것들을 이번 기회에 정리하려 한다.

## 내가 생각하는 코드 리뷰. 더 나은 코드 리뷰

- 코드 리뷰를 통해 무엇을 얻을 수 있을까? 개인적으로 생각하는 **코드 리뷰의 순 기능**은 아래와 같다.
  - 장애나 버그를 만드는 코드를 사전에 발견 및 수정
  - 컨벤션을 벗어난 코드들을 일관되게 유지
  - 코드 리뷰에 참여한 사람들이 합의하는 가독성이 더 나은 코드를 배포
- 리뷰를 통해 위와 같은 장점들을 얻을 수 있다고 하면 **더 나은 코드리뷰는 어때야 할까?**
  - 리뷰를 통해 서로의 성장을 돕는다.
  - 서로를 배려해야 한다.
  - 개선이나 변경을 요청한 코드에 대해 이유를 충분히 설명해야 한다.

## 코드 리뷰의 부작용

- 코드 리뷰가 좋은 개발 문화라고 해서 무작정 시작하다가 **부작용이 발생하는 경우**도 있다.
- 더 나은 코드 리뷰를 위한 방법을 알아보기 전에 코드 리뷰의 부작용을 살펴보자.

### 병목이 되는 코드 리뷰

- 가장 흔히 볼 수 있는 부작용은 바로 코드 **리뷰가 일의 진척을 방해하는 상황**이다.
- 대부분 리뷰가 빠르게 진행되지 않아서 발생하는데 왜 그럴까?
  - 리뷰어들의 일정이나 기능 개발이 바쁠 경우 리뷰는 자연스럽게 후 순위로 밀리게 된다.
  - PR이 어떠한 요구사항을 해결하기 위해 어떠한 변경사항을 담고 있는 것인지 리뷰어가 이해하고 리뷰하는 과정에 시간과 에너지가 많이 소모된다.
  - 일부 PR의 경우, 변경 사항의 사이즈가 커서 리뷰하는 데 있어 확인해야 하는 범위가 크고 부담으로 다가온다.

### 의미없는 코드 리뷰

- 무지성 Approve 단계를 말한다.
- 각자의 개발을 진행하느라 바쁘다 보니 서로의 코드를 잘 안 보게 되고, 보더라도 깊이 있게 못 보니 유의미한 리뷰가 없는 것이다.
- 그 와중에 내 코드는 빨리 리뷰돼서 main branch에 들어가길 바라는 동상이몽이 펼쳐진다.

### 싸움이 되는 코드 리뷰

- 코드를 가지고 싸우기도 한다. 리뷰를 남기는 사람의 공격적인 말투도 있겠지만, 말투를 바꾸더라도 상처가 될 수 있다.
- 더 근원적인 문제가 있기 때문인데, 리뷰를 받는 사람이 **리뷰를 자신에 대한 비난이라고 받아들이게 되면 비극이 시작**된다.

### 책임 소재를 묻는 코드 리뷰

- 리뷰에 승인을 하는 것은 이 코드에 대한 책임을 함께 갖는 것이다. 라는 이야기도 있다.
- 이런 의미를 코드 리뷰 승인에 부여해서 얻는 실익이 없다. 문제가 된 코드의 작성자는 **`리뷰를 받았으니 이 문제는 공동 책임이야!`** 라고 외쳐서 달라질 것도 없다.
- 문제의 **책임은 그저 시스템**에 있다. 문제가 발생했다면 시스템을 회고하고 문제가 됐던 부분을 함께 개선하면 된다.

## 공감되는 좋은 코드 리뷰에 대한 문화와 방법들

- 여러 블로그들을 보면서 공통적으로 나오는 내용이나 동의하는 코드리뷰 방법들과 문화들을 정리한다.

### PR 잘 요청하기

#### 코드 리뷰에서 LoC(Line Of Code)의 변경은 300 Line을 넘지 않도록 한다

- Cisco 시스템 프로그래밍 팀의 연구에 따르면 **300줄에서 400줄 정도의 코드를** 60분에서 90분 동안 리뷰하면 70 ~ 90%의 결함을 발견할 수 있다고 한다. 코드 리뷰와 관련된 여러 블로그를 읽으면서도 평균적으로 250 ~ 300 Line 이하를 권하는 추세

  <img src="https://github.com/programmer-sjk/TIL/blob/main/images/culture/review-loc.png" width="500">

- 라인 수에 따른 결함 발견 밀집도

<img src="https://github.com/programmer-sjk/TIL/blob/main/images/culture/defect-loc.png" width="500">

#### 리뷰어에게 PR을 통해 충분한 정보를 제공하자

```txt
Reviewer resource is very limited, treat it wisely!
(리뷰어는 매우 제한되어 있으니 그들을 현명하게 다룹시다!)
```

- 리뷰어 **N명의 시간을 절약하기 위해** 충분한 정보를 제공하는 것이 중요하다. **`저자가 고생해서`** 리뷰어의 시간을 아껴줘야 한다.
- 무슨 이유로 어떻게 코드를 변경했는지, 어떤 위험이나 우려가 발견되었는지에 대한 충분한 정보를 리뷰어에게 제공해야 한다.
- 구현된 코드에 대한 전체적인 문맥을 Reviewer가 적은 노력으로도 충분히 비슷한 수준으로 파악할 수 있도록 자세하게 설명해야 한다.
- PR 템플릿을 잘 활용하자

  <img src="https://github.com/programmer-sjk/TIL/blob/main/images/culture/prtemplate.png" width="800">

### 개선이 필요한 이유에 대해 충분한 설명을 한다

- 리뷰어가 코드 개선의 필요성을 느끼고 **리뷰를 남긴다면 충분한 이유가 뒷받침**되어야 한다.
- 만약 코드 리뷰가 주관적이거나 추상적이라면 리뷰이는 혼란을 느낄 수 있다.

  ```ts
  const data = [
    ["데이터베이스", "A", 3],
    ["교양영어", "B+", 1],
    ["철학", "A", 2],
  ];

  /* 안 좋은 리뷰
  data 변수 말고 다른 변수명으로 하세요.
  data 변수 말고 grade로 하세요.
  */

  /* 좋은 리뷰
  data라는 이름은 현재의 자료구조가 무엇인지 그 의도를 알기가 어렵네요.
  학점 정보를 담고 있는 자료구조 같은데 이와 관련된 변수명을 짓는다면
  현재 정의한 자료구조가 무엇인지 그 의도를 쉽게 파악할 수 있을 것 같아요.
  */
  ```

- 개선이 필요한 이유를 구체적으로 설명한 피드백으로 답을 알려주는 것이 아니라 개선의 필요성만 설명하고 있기 때문에 리뷰이는 스스로 생각하고 학습할 계기가 된다.

### 개발자의 성향을 리뷰하는 것을 지양하자

- **`개발자의 성향을 리뷰한다면 리뷰하는 장점이 사라지게 된다.`**

```ts
function getDay(date) {
  if (isWeekend(date)) {
    return weekend;
  } else {
    return weekday;
  }
}
```

- 위 예제 코드의 경우 추가적인 연산이 없으므로 조건문에 대한 가독성은 주관적일 수 있다.
- 안좋은 리뷰

  - `return isWeekend(date) ? weekend : weekday; 로 작성해 보세요. 코드가 깔끔해집니다.`

### 객관적으로 피드백하라

- `별론거 같아요. 이때까지 이렇게 해왔어요.` 와 같은 리뷰와 피드백은 좋지 않다.
- 명확하고 객관적인 이유가 없는 리뷰는 차라리 달지 않는 것이 리뷰어와 리뷰이의 에너지 소비를 줄일 수 있다.
- 누구나 납득할만한 **객관적이고 일반적인 원칙을 제시**하자. **설득력은 거기서부터 온다.**
- 물론 개발자의 취향이 반영된 리뷰가 있을 수 있다. 그렇다면 적어도 그렇게 생각하게 된 이유와 그 이유를 뒷받침하는 레퍼런스를 적어주는 것이 좋다.

### 추가 커뮤니케이션을 피하도록 충분히 전달하자

- 질문을 하거나 대답을 할 때, 내가 알고 있는 것을 상대방도 알고 있을 것이라는 가정을 하지 않고 충분한 문맥을 전달해야 한다.
- 상대방의 의도를 파악하기 위한 **추가적인 커뮤니케이션 또는 미스 커뮤니케이션으로 발생하는 비용이 매우 비싼 비용**이라는 문제의식을 공유한다.

### 해결사가 아니라 조언자가 되자

- 코드 리뷰에서 너무 공격적인 어투나 본인의 지식을 자랑하지 말자.
- 예를 들어 `이 코드는 이 부분이 잘못되었어요.` 라는 리뷰 보다는 `이 부분은 이런 문제가 있을 가능성이 있네요. 이런 방법으로 한번 체크해 보는 건 어떨까요?` 라는 식의 조언을 통한 부드러운 코드 리뷰를 이끌어 보자.
- 팀 정신을 위해 **불완전한 해결책을 받아들여라**. 코드 리뷰의 목적은 비난이 아니라 배움이다.
- 리뷰어는 의견을 제시할 수 있지만, 수정에 대한 **결정은 작성자가** 하도록 한다.
- 사소한 이슈만 있다면 흔쾌히 승인하자.
  - 서로의 입장차를 좁히지 못해서 교착상태에 빠지곤 하는데 누가 보아도 문제인 코드는 교착상태에 쉽게 빠지지 않는다.
  - 자신의 의견은 한번 또는 최대 2번까지 관철 시켜보고 입장차가 좁혀지지 않으면 쿨하게 상대방의 의견을 받아들여보자.
  - 시간이 지나면 의외로 그 문제는 아무것도 아닐 수 있다. 중요한건 팀원끼리의 팀워크와 효율적인 업무를 이어가는 것이다.

### 코드 == 나 라는 인식을 버리자

- 시간이 지나도 이 부분에 대해 100% 인식을 버릴 수 있을지는 모르겠다. 그래도 인식을 버릴수록 리뷰 과정에선 도움이 된다.
- 우리는 모두 코드를 더 좋게 만들기 위한 의지가 있다. 그렇기 때문에 솔직하게 이야기하고 건강하게 충돌하자.
- **`자신의 코드가 자신을 나타낸다는 생각을 버리자.`** 감정 소비를 줄이고 리뷰어의 리뷰에 객관적으로 피드백을 할 수 있을 것이다.

### 리뷰를 위한 리뷰를 하지 말자. 피드백 할 게 없으면 서로 칭찬하자

- 리뷰할 부분이 없는데 흔적을 남기기 위해 리뷰할 경우 서로 어색해지는 경우도 발생한다.
- 이런 경우 **칭찬 피드백**을 주는 것도 한 가지 방법이다.
  - 코드량이 적당해서 읽기 편하네요.
  - 많은 고민이 코드에서 엿보이네요.
  - 성능에 아주 유리한 코드라고 생각되네요.
  - 전에 코드보다 훨씬 좋아진 거 같네요.
  - 예외 처리가 꼼꼼해서 좋네요.
  - 함수, 변수명이 직관적이어서 좋네요.

## 여러 실제 리뷰 스크린 샷 중에 좋았다고 생각한 리뷰 예시

- 아래 링크에서 화살표 버튼을 눌러 실제 리뷰한 내용의 스크린 샷을 확인할 수 있다.
- [토스 페이먼츠 팀 - 주로 어떤 내용을 리뷰할까?](https://tosspayments-dev.oopy.io/chapters/frontend/about#7c1be862-14e1-470e-94cc-702a05bfd5cb)
- 한 가지 예시

  <img src="https://github.com/programmer-sjk/TIL/blob/main/images/culture/good-review-example.png" width="600">

## 레퍼런스

- <https://devocean.sk.com/blog/techBoardDetail.do?ID=165255>
- <https://tech.kakao.com/2022/03/17/2022-newkrew-onboarding-codereview/>
- <https://veluxer62.github.io/explanation/consideration-of-good-code-review/>
- <https://velog.io/@jiseung/code-review>
- <https://tosspayments-dev.oopy.io/chapters/frontend/about#7c1be862-14e1-470e-94cc-702a05bfd5cb>
