# 선착순 이벤트 시스템

- [인프런 강의](https://www.inflearn.com/course/%EC%84%A0%EC%B0%A9%EC%88%9C-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%8B%A4%EC%8A%B5/dashboard)

## 요구사항

- 선착순 100 명에게 할인 쿠폰을 제공해야 한다.
- 100개가 초과되어 발급되면 안 된다.
- 순간적으로 몰리는 트래픽을 감당할 수 있어야 한다.

## 쿠폰 발급 로직

- Coupon Entity는 다음과 같다.

```java
@Entity
public class Coupon {
  private Long id;
  private Long userId; // 발급받은 user id

  public Coupon() {}
  public Coupon(Long userId) {
    this.userId = userId;
  }

  public Long getId() {
    return id;
  }
}
```

- Coupon을 발급하는 Service 로직은 아래와 같다.

```java
@Service
public class ApplyService {
  private final CouponRepository couponRepository;
  public ApplyService(CouponRepository couponRepository) {
    this.couponRepository = couponRepository;
  }

  public void apply(Long userId) {
    long count = couponRepository.count();

    if (count > 100) {
      return;
    }

    couponRepository.save(new Coupon(userId));
  }
}
```
